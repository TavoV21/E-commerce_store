pipeline{
    agent any

    tools{
        nodejs "node"
    }

    environment{
        GMAIL_CREDS = credentials('NODEMAILER_AUTH')
    }
    
    stages{
       
        stage('docker login'){
            steps{

               /*  withCredentials([usernamePassword(credentialsId: 'DOCKER_CREDENTIALS', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]){
                    sh ''' 
                        echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
                    '''
                }  
 */
                 withCredentials([usernamePassword(credentialsId: 'DOCKER_GUEST_AUTH', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]){
                    sh ''' 
                        echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
                    '''
                }        
                
            }

            post {
                success {
                    echo "✅ te loggeaste OMG"
                }
                failure {
                    echo "❌ algo anda mal"
                }
            }
        }

        stage('test'){
            steps{
                sh 'docker compose version'
                sh 'docker compose -f docker-compose.test.yml up'
                sh 'docker compose -f docker-compose.test.yml down -v'
            }


        }

        
       
    }
}