pipeline{
    agent any

    tools{
        nodejs "node"
    }
    
    stages{
        
        stage('install'){
            dir('backend'){
                sh 'node -v'
                sh 'yarn install'
            }
        }

        stage('test'){
            steps{
                dir('backend'){             
                    sh 'yarn test tests/categories.test.mjs'
                }
            }
        }
       
        stage('docker login'){
            steps{
/* 
               withCredentials([string(credentialsId: 'DOCKER_TOKEN', variable: 'TOKEN')]) {
                    sh '''
                        echo "$TOKEN" | docker login -u TavoV21 --password-stdin
                    '''
                } */
                withCredentials([usernamePassword(credentialsId: 'DOCKER_CREDENTIALS', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]){
                    sh ''' 
                        echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
                    '''
                }
                    
                
                
            }

            post {
                success {
                    echo "✅ te loggeaste OMG"
                }
                failure {
                    echo "❌ algo anda mal"
                }
            }
        }
       
    }
}